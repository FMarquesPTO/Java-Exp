/**********************************
  (c) Copyright 2020 @FMarquesPTO.
  All rights reserved.
***********************************/
{
  "namespace": "ingame_hud_jexp_test",

  /* bossbars */

  /* Chat msgs and actionbar */
  "chat_panel": {
    "type": "panel",
    "clips_children": true,
    "anchor_from": "$chat_anchor",
    "anchor_to": "$chat_anchor",
    "size": "$chat_size",
    "offset": "$chat_offset",
    "controls": [
      { "stack": {
          "type": "stack_panel",
          "anchor_from": "bottom_left",
          "anchor_to": "bottom_left",
          "offset": [0, -1],
          "factory": {
            "name": "chat_item_factory",
            "max_children_size": 50,
            "control_ids": { "chat_item": "chat_item@ingame_hud_jexp_test.chat_grid_item" }
          }
        }
      }
    ]
  },

  "chat_grid_item": {
    "type": "panel",
    "layer": 1,
    "size": [ "100%", "100%c" ],
    "anchor_from": "bottom_middle",
    "anchor_to": "bottom_middle",
   /*  "bindings": [
      {
        "binding_collection_name": "chat_text_grid",
        "binding_type": "collection_details"
      },
      {
        "binding_name": "view",
        "source_property_name": "(not #chat_text = 'You can only sleep at night')",
        "target_property_name": "#visible"
      }
    ], */
    "bindings": [
      {
        "binding_name": "(not #chat_text = 'You can only sleep at night' or not #chat_text = 'You may not rest now, there are monsters nearby'))",
        "binding_name_override": "#visible",
        "binding_type": "collection",
        "binding_collection_name": "chat_text_grid"
      }
    ],
    "controls": [
      { "chat_background": {
          "type": "image",
          "texture": "src/assets/white",
          "color": "$chat_bg_color",
          "alpha": "$chat_bg_alpha",
          "size": ["100%", "100%c - 1px"],
          "anims": ["@ingame_hud.anim_chat_bg_wait"],
          "controls": [ { "chat_text@ingame_hud_jexp_test.chat_label": { "offset": [2, 1] } } ]
        }
      }
    ]
  },

  "chat_label@hud.chat_label": {
    "shadow": true,
    "size": ["100% - 2px", "default"],
    "anchor_from": "bottom_left",
    "anchor_to": "bottom_left",
    "offset": [2, 1],
    "line_padding": "$chat_lines_spacing",
    "anims": [ "@ingame_hud.anim_chat_txt_wait" ]
  },

  "hud_actionbar_text": {
    "type": "panel",
    "controls": [
      { "@0_ab": {}},
      { "@1_ab": {}}
    ]
  },

  "stack": {
    "type": "stack_panel",
    "size": ["100%", "10px"],
    "anchor_from": "bottom_middle",
    "anchor_to": "bottom_middle",
    "$visBdg": "(#chat_text = 'You can only sleep at night')",
    "factory": {
      "name": "chat_item_factory",
      "max_children_size": 50,
      "control_ids": { "chat_item": "chat_item@ingame_hud_jexp_test.a_label" }
    },
    "bindings": [
      { "binding_name": "$visBdg",
        "binding_name_override": "#visible",
        "binding_type": "collection",
        "binding_collection_name": "chat_text_grid"
      }
    ]
  },

  "a_label@hud.chat_label": {
    "shadow": true,
    "size": ["100% - 2px", "default"],
    "anchor_from": "bottom_middle",
    "anchor_to": "bottom_middle",
    "offset": [0, "50%-68px"],
    "text": "You can only sleep at night"
  },

  "custom_actionbar": {
    "type": "panel",
    "size": ["100%", "100%cm"],
    "offset": [0, "50%-68px"],
    "alpha": "@hud.anim_actionbar_text_alpha_out",
    "propagate_alpha": true,
    "bindings": [
      { "binding_name": "$visBdg",
        "binding_name_override": "#visible",
        "binding_type": "collection",
        "binding_collection_name": "chat_text_grid"
      }
    ],
    "controls": [
      { "background": {
          "type": "image",
          "size": ["100%sm + 12px", "100%sm + 5px"],
          "texture": "textures/ui/hud_tip_text_background",
          "alpha": "@hud.anim_actionbar_text_background_alpha_out",
          "ignored": "(not $show_dark_bg_below_hud_texts)"
        }
      },
      { "actionbar_message": {
          "type": "label",
          "anchor_from": "center",
          "anchor_to": "center",
          "color": "white",
          "layer": 1,
          "text": "$text",
          "localize": false
        }
      }
    ]
  },

  "default_ab@ingame_hud_jexp_test.custom_actionbar": {
    "$visBdg": "(not #chat_text = 'You can only sleep at night' or not #chat_text = 'You may not rest now, there are monsters nearby'))",
    "$text": "$actionbar_text"
  },

  "0_ab@ingame_hud_jexp_test.custom_actionbar": {
    "$visBdg": "(#chat_text = 'You can only sleep at night')",
    "$text": "You can only sleep at night"
  },

  "1_ab@ingame_hud_jexp_test.custom_actionbar": {
    "$visBdg": "(#chat_text = 'You can only sleep at night')",
    "$text": "You can only sleep at night"
  },
  
  /* Coordinates */
  "player_position": {
    "type": "stack_panel",
    "size": ["100%c", "100%c"],
    "anchor_from": "top_left",
    "anchor_to": "top_left",
    "controls": [
      { "x": {
          "type": "stack_panel",
          "orientation": "horizontal",
          "size": ["100%c", 10],
          "controls": [
            { "x": {
                "type": "label",
                "text": "X: "
              }
            },
            { "value": {
                "type": "panel",
                "size": ["33.3333%c - 20px", 10],
                // "clips_children": true,
                "controls": [
                  { "x@ingame_hud_jexp_test.player_position_text": {
                      "offset": [-24, 0]
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      { "Z": {
          "type": "stack_panel",
          "orientation": "horizontal",
          "size": ["100%c", 10],
          "controls": [
            { "Z": {
                "type": "label",
                "text": "Z: "
              }
            },
            { "value": {
                "type": "panel",
                "size": ["33.3333%c - 20px", 10],
                // "clips_children": true,
                "controls": [
                  { "z@ingame_hud_jexp_test.player_position_text": {
                      "anchor_from": "top_right",
                      "anchor_to": "top_right",
                      "offset": ["0px", 0]
                    }
                  }
                ]
              }
            }
          ]
        }
      } 
    ],
    "bindings": [
      { "binding_name": "#player_position_visible",
        "binding_name_override": "#visible",
        "binding_condition": "always",
        "binding_type": "global"
      }
    ]
  },

  "player_position_text": {
    "type": "label",
    "text": "#text",
    "anchor_from": "top_left",
    "anchor_to": "top_left",
    "shadow": true,
    "layer": 1,
    "bindings": [
      { "binding_name": "#player_position_text",
        "binding_name_override": "#text",
        "binding_condition": "always_when_visible",
        "binding_type": "global"
      }
    ]
  }
}